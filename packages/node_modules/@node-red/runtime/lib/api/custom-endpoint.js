// custom-endpoint.js
var runtime;

var api = {
    init: function(_runtime) {
        runtime = _runtime;
    },

    getCustomMessage: async function(opts) {
        try {
            runtime.log.audit({ event: "customMessage.get" }, opts.req);
            const jwtToken = process.env.JWT_TOKEN;
            
            if (!jwtToken) {
                throw new Error("JWT_TOKEN is not defined in environment variables");
            }

            return { jwtToken: jwtToken };
        } catch (error) {
            runtime.log.error({ event: "customMessage.error", message: error.message });
            throw error;
        }
    }
};


module.exports = function(RED) {
    function CustomEndpointNode(config) {
        RED.nodes.createNode(this, config);
        var node = this;

        // Define the custom endpoint
        RED.httpAdmin.get('/custom-endpoint', function(req, res) {
            api.getCustomMessage({ req: req })
                .then(response => res.json(response))
                .catch(error => res.status(500).json({ error: error.message }));
        });
    }

    // Register the custom node type
    RED.nodes.registerType('custom-endpoint', CustomEndpointNode);
};